{
  "kind": "build_request",
  "title": "Fix outgoing service generation for target laborer",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-46",
      "text": "Debug and fix the outgoing service generation issue in BookingsDashboard.tsx where bookings created for a target laborer (where the current user is the requester) are not appearing in the outgoing requests section, investigating the booking data flow from creation through query refetch and display logic",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-user-latest"
        ],
        "quotes": [
          "FOR TARGET LABOURER OUTGOING SERVICE IS NOT GENERATING"
        ]
      },
      "acceptanceCriteria": [
        "When a laborer creates a booking request for another laborer (target laborer), the booking immediately appears in the requester's outgoing requests section",
        "The outgoing requests section correctly identifies bookings where the current user is the requester",
        "Newly created bookings are displayed without requiring manual page refresh",
        "The booking classification logic properly distinguishes between outgoing and incoming bookings based on requester/provider principals"
      ]
    },
    {
      "id": "REQ-47",
      "text": "Add comprehensive debug logging to the BookingsDashboard.tsx component to track the complete data flow for outgoing bookings, including query fetch status, booking array contents, principal comparisons for classification, and timing of re-renders after booking creation",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-user-latest"
        ]
      },
      "acceptanceCriteria": [
        "Console logs capture when bookings query is refetched after a new booking is created",
        "Logs show the principal comparison logic that classifies bookings as outgoing vs incoming",
        "Logs display the number of outgoing bookings found and their IDs",
        "Logs indicate whether the query invalidation and refetch successfully triggered after booking creation"
      ]
    },
    {
      "id": "REQ-48",
      "text": "Verify that the createBooking mutation in useQueries.ts properly triggers query invalidation for the 'bookings' query key after successful booking creation, ensuring the BookingsDashboard automatically refetches and displays the new outgoing booking",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-user-latest"
        ]
      },
      "acceptanceCriteria": [
        "The onSuccess callback in createBooking mutation explicitly invalidates the bookings query",
        "Query invalidation triggers an immediate refetch of all bookings",
        "The BookingsDashboard receives updated booking data including the newly created booking",
        "No manual refresh is required for the new booking to appear in the outgoing section"
      ]
    },
    {
      "id": "REQ-49",
      "text": "Investigate and fix any timing issues or race conditions in BookingsDashboard.tsx that might prevent newly created bookings from appearing immediately in the outgoing requests section, ensuring proper React Query cache synchronization",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-user-latest"
        ]
      },
      "acceptanceCriteria": [
        "The dashboard properly handles the transition from booking creation to display",
        "No race conditions exist between query invalidation and component re-render",
        "The outgoing bookings filter function correctly processes newly added bookings",
        "Component state properly reflects the updated bookings array after refetch"
      ]
    }
  ],
  "constraints": [
    "Do not modify backend/main.mo unless the issue is proven to be in backend data storage or retrieval",
    "Preserve all existing booking classification logic that correctly handles incoming bookings",
    "Maintain the existing query invalidation patterns used throughout useQueries.ts"
  ],
  "nonGoals": [
    "Redesigning the bookings dashboard UI layout",
    "Adding new booking statuses or workflow states",
    "Modifying the backend booking data model",
    "Changing authentication or Internet Identity integration"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}